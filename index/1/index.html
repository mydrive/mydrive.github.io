<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="MyDrive Solutions">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
<link href='/assets/stylesheets/bootstrap.min-88238289010db19359d2181e634e95cd.css' type='text/css' rel='stylesheet' media='all'>
<link href='/assets/stylesheets/style-e81fa375b231bedf6cb2dbc6653570cc.css' type='text/css' rel='stylesheet' media='all'>
<link href='/assets/stylesheets/google_prettify/sons-of-obsidian-afb0925bfa2d994f17dab93e13fbf999.css' type='text/css' rel='stylesheet' media='all'>
    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  <link rel="shortcut icon" href="/assets/media/favicon.ico">
  </head>

  <body>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="/">MyDrive Engineering</a>
          <ul class="nav">
              
                <li><a href="/archive">Archive</a></li>
              
              
                <li><a href="/tags">Tags</a></li>
              
              
                <li><a href="/categories">Categories</a></li>
              
          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="content">
        <div class="row-fluid">
  <div class="span12">
      <div class="_root">
        <h3 class="title"><a href="/archive">Archive</a> <span class="date"></span></h3>

        <div class="summary">
  <h2>2015</h2>
    <h3>January</h3>
    <ul>
      <li>
<span>2015-01-29</span> » <a href="/posts/ruby_thread_sync">Ruby Thread Synchronisation</a>
</li>
    </ul>
  <h2>2014</h2>
    <h3>October</h3>
    <ul>
      <li>
<span>2014-10-30</span> » <a href="/posts/rails-cve-2014-7818">Ruby on Rails CVE-2014-7818</a>
</li>
      <li>
<span>2014-10-17</span> » <a href="/posts/security-update-2014-10-17">Security Updates (POODLE and OpenSSL)</a>
</li>
      <li>
<span>2014-10-08</span> » <a href="/posts/swift_data_collection">iOS Device Motion Data Collection Using Swift</a>
</li>
      <li>
<span>2014-10-07</span> » <a href="/posts/shellshock">Shellshock - MyDrive's Actions</a>
</li>
    </ul>
</div>

        <div class="more">
          <a href="/archive" class="btn btn-small">read more..</a>
        </div>
      </div>
      <div class="_root">
        <h3 class="title"><a href="/categories">Categories</a> <span class="date"></span></h3>

        <div class="summary ellipsis">
<ul class="tag_box inline">
  <li>
    <a href="/categories#security-ref">security <span>3</span></a>
  </li>
  <li>
    <a href="/categories#development-ref">development <span>2</span></a>
  </li>
  <li>
    <a href="/categories#programming-ref">programming <span>2</span></a>
  </li>
</ul>

  <h3>security (3)</h3>
  <ul>
      <li><a href="/posts/rails-cve-2014-7818">Ruby on Rails CVE-2014-7818</a></li>
      <li><a href="/posts/security-update-2014-10-17">Security Updates (POODLE and OpenSSL)</a></li>
      <li><a href="/posts/shellshock">Shellshock - MyDrive's Actions</a></li>
  </ul>
  <h3>development (2)</h3>
  </div>

        <div class="more">
          <a href="/categories" class="btn btn-small">read more..</a>
        </div>
      </div>
      <div class="_root">
        <h3 class="title"><a href="/">MyDrive Engineering</a> <span class="date"></span></h3>

        <div class="summary ellipsis">
<p>Multi-Threading programming is one of those things that I like doing from time
to time. I find it particularly useful when automating any task that involves
network downloading.</p>

<p>My approach is usually a <a href="http://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern">Publish-subscribe</a> using the very handy Ruby's
<a href="http://ruby-doc.org/stdlib-2.0/libdoc/thread/rdoc/Queue.html"><code>Queue</code> class</a>.</p>

<p>Sometimes I build it using several stages, i.e. last time I used it I was building
a tool for downloading and processing a whole S3 bucket and I designed it with
two messaging layers. First one publishes object names within the bucket
for the second one to pick them and actually download and process them and finally
publish the results for an aggregator thread (the main program's thread).</p>

<p><img src="/media/2_stages_pub_sub_diagram.png" alt="2 Stages Pub Sub Diagram"></p>

<p>My programming approach to this is leveraging all synchronisation in queues rather
than waiting for threads or passing messages between them.
But don't worry, that's not a crazy or hacky approach at all, is just the Ruby's
recommended way.</p>

<p>So, what I'm going to do here is just explain by an example how to properly do
it avoiding errors and obtaining a clean end. Let's start off by showing a
failing example.</p>
</div>

        <div class="more">
          <a href="/" class="btn btn-small">read more..</a>
        </div>
      </div>
      <div class="_root">
        <h3 class="title"><a href="/pages">Pages</a> <span class="date"></span></h3>

        <div class="summary">
<ul>
  
    <li><a href="/archive">Archive</a></li>
  
  
    <li><a href="/categories">Categories</a></li>
  
  
    <li><a href="/">MyDrive Engineering</a></li>
  
    <li class="active"><a href="/pages" class="active">Pages</a></li>
  
  
  
    <li><a href="/tags">Tags</a></li>
  
</ul>
</div>

        <div class="more">
          <a href="/pages" class="btn btn-small">read more..</a>
        </div>
      </div>
      <div class="_root">
        <h3 class="title"><a href="/tags">Tags</a> <span class="date"></span></h3>

        <div class="summary ellipsis">
<ul class="tag_box inline">
  <li>
    <a href="/tags#security-ref">security <span>3</span></a>
  </li>
  <li>
    <a href="/tags#ops-ref">ops <span>3</span></a>
  </li>
  <li>
    <a href="/tags#ruby-ref">ruby <span>1</span></a>
  </li>
  <li>
    <a href="/tags#rails-ref">rails <span>1</span></a>
  </li>
  <li>
    <a href="/tags#Ruby-ref">Ruby <span>1</span></a>
  </li>
  <li>
    <a href="/tags#Threading-ref">Threading <span>1</span></a>
  </li>
  <li>
    <a href="/tags#Publish-subscribe-ref">Publish-subscribe <span>1</span></a>
  </li>
  <li>
    <a href="/tags#Messaging-ref">Messaging <span>1</span></a>
  </li>
  <li>
    <a href="/tags#Patterns-ref">Patterns <span>1</span></a>
  </li>
  <li>
    <a href="/tags#Synchronisation-ref">Synchronisation <span>1</span></a>
  </li>
  <li>
    <a href="/tags#POODLE-ref">POODLE <span>1</span></a>
  </li>
  <li>
    <a href="/tags#SSL-ref">SSL <span>1</span></a>
  </li>
  <li>
    <a href="/tags#shellshock-ref">shellshock <span>1</span></a>
  </li>
  <li>
    <a href="/tags#iOS-ref">iOS <span>1</span></a>
  </li>
  <li>
    <a href="/tags#Swift-ref">Swift <span>1</span></a>
  </li>
  <li>
    <a href="/tags#memory%20management-ref">memory management <span>1</span></a>
  </li>
  <li>
    <a href="/tags#data%20collection-ref">data collection <span>1</span></a>
  </li>
</ul>
</div>

        <div class="more">
          <a href="/tags" class="btn btn-small">read more..</a>
        </div>
      </div>
    
    <div class="pagination">
      <ul>
          <li class="active"><a href="/index/1">1</a></li>
      </ul>
    </div>
  </div>
</div>

      </div>

      <hr>
      <div class="footer">
        <p>&copy; <a href="http://mydrivesolutions.com" target="_blank">MyDrive Solutions Limited</a> 2014
          with help from <a href="http://ruhoh.com" target="_blank" title="The Definitive Technical Blogging Framework">ruhoh</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </div>

    </div> <!-- /container -->

    <!-- Google Prettify -->
<script src="http://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js"></script>
<script>
  var pres = document.getElementsByTagName("pre");
  for (var i=0; i < pres.length; ++i) {
    pres[i].className = "prettyprint linenums";
  }
  prettyPrint();
</script>
<!-- end Google Prettify -->
    <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-32835100-1']);
  _gaq.push(['_trackPageview']);
  

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


    
  </body>
</html>
